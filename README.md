# Text-to-Chain
### DeFi for the Next Billion Users â€” Powered by SMS & AI Agents
*"Bringing the power of Web3 to 2.5 billion feature phone users via simple text messages."*

---

# COMPLETE SYSTEM FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER SEGMENTS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USERS (Tier 1 Users)        â”‚         â”‚  USERS (Tier 2 Users)        â”‚
â”‚                              â”‚         â”‚                              â”‚
â”‚  â€¢ Have crypto in exchanges  â”‚         â”‚  â€¢ Cash only                 â”‚
â”‚  â€¢ 90% of unbanked worldwide â”‚         â”‚  â€¢ No bank account           â”‚
â”‚  â€¢ Have smartphones          â”‚         â”‚  â€¢ 10% of unbanked           â”‚
â”‚  â€¢ Use MetaMask/Binance      â”‚         â”‚  â€¢ Feature phones            â”‚
â”‚  â€¢ ~100M users potential     â”‚         â”‚  â€¢ ~2.5B users potential     â”‚
â”‚                              â”‚         â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                        â”‚
             â”‚                                        â”‚
             â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ONBOARDING PATH A         â”‚         â”‚   ONBOARDING PATH B         â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   Direct Crypto Deposit     â”‚         â”‚   Buy Voucher at Shop       â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   SMS: "JOIN"               â”‚         â”‚   SMS: "JOIN"               â”‚
â”‚   â†’ Wallet created          â”‚         â”‚   â†’ Wallet created          â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   SMS: "DEPOSIT"            â”‚         â”‚   SMS: "DEPOSIT"            â”‚
â”‚   â†’ Get address             â”‚         â”‚   â†’ Get address             â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   Send from MetaMask        â”‚         â”‚   Visit shop with cash      â”‚
â”‚   â†’ Polygon network         â”‚         â”‚   â†’ Buy â‚¹500 voucher        â”‚
â”‚   â†’ 0x742d35Cc..            â”‚         â”‚   â†’ Get voucher code        â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   Wait 1 min                â”‚         â”‚   SMS: "REDEEM [code]"      â”‚
â”‚   â†’ Backend detects         â”‚         â”‚   â†’ Custom tokens sent      â”‚
â”‚   â†’ Auto-swap if needed     â”‚         â”‚   â†’ Redeem in account       â”‚
â”‚                             â”‚         â”‚   â†’ ETH swapped for it      â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚   SMS: "âœ“ 50 USDC received!"â”‚         â”‚   SMS: "âœ“ 0.1 ETH received!"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                        â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   UNIFIED SMS INTERFACE  â”‚
                â”‚                         â”‚
                â”‚   All users interact    â”‚
                â”‚   the same way          â”‚
                â”‚   via SMS commands      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BACKEND SERVICES (RUST)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. SMS WEBHOOK HANDLER     â”‚
â”‚                              â”‚
â”‚   Receives SMS from Twilio   â”‚
â”‚   â†“                          â”‚
â”‚   Parse command              â”‚
â”‚   â†“                          â”‚
â”‚   Route to appropriate       â”‚
â”‚   service                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                       â”‚
             â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ACCOUNT MANAGEMENT   â”‚  â”‚ 3. WALLET SERVICE        â”‚
â”‚                         â”‚  â”‚                          â”‚
â”‚ Commands:               â”‚  â”‚ â€¢ Create wallet          â”‚
â”‚ â€¢ JOIN                  â”‚  â”‚ â€¢ Generate keypair       â”‚
â”‚ â€¢ BALANCE               â”‚  â”‚ â€¢ HISTORY               â”‚
â”‚ â€¢ PIN [xxxx]            â”‚  â”‚ â€¢ Encrypt private key    â”‚
â”‚                         â”‚  â”‚ â€¢ Store in DB            â”‚
â”‚ Database:               â”‚  â”‚ â€¢ Multi-chain support    â”‚
â”‚ users                   â”‚  â”‚                          â”‚
â”‚ â”œâ”€ id                   â”‚  â”‚ Encryption:              â”‚
â”‚ â”œâ”€ phone                â”‚  â”‚ â€¢ AES-256-GCM            â”‚
â”‚ â”œâ”€ wallet_address       â”‚  â”‚ â€¢ Key derivation         â”‚
â”‚ â”œâ”€ encrypted_key        â”‚  â”‚ â€¢ Secure storage         â”‚
â”‚ â”œâ”€ pin_hash             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”œâ”€ balance_usdc         â”‚
â”‚ â””â”€ created_at           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. DEPOSIT DETECTION SERVICE                                     â”‚
â”‚                                                                  â”‚
â”‚ Multi-Chain Monitoring:                                          â”‚
â”‚                                                                  â”‚
â”‚ Ethereum RPC â”€â”                                                  â”‚
â”‚ Polygon RPC â”€â”€â”¼â”€â†’ WebSocket Listeners                            â”‚
â”‚ Base RPC â”€â”€â”€â”€â”€â”¤   â†“                                              â”‚
â”‚ Arbitrum RPC â”€â”˜   Detect tx to user wallets                      â”‚
â”‚                   â†“                                              â”‚
â”‚                   Filter by address                              â”‚
â”‚                   â†“                                              â”‚
â”‚                   Wait for confirmations (12 blocks)             â”‚
â”‚                   â†“                                              â”‚
â”‚                   Tokens added? â”€â”€Yesâ†’ Update balance            â”‚
â”‚                   â†“                                              â”‚
â”‚                   Send SMS notification                          â”‚
â”‚                                                                  â”‚
â”‚ Components:                                                      â”‚
â”‚ â€¢ BlockchainListener (per chain)                                 â”‚
â”‚ â€¢ TransactionFilter                                              â”‚
â”‚ â€¢ ConfirmationTracker                                            â”‚
â”‚ â€¢ AutoSwapOrchestrator                                           â”‚
â”‚ â€¢ BalanceUpdater                                                 â”‚
â”‚ â€¢ SMSNotifier                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. VOUCHER SYSTEM                                                â”‚
â”‚                                                                  â”‚
â”‚ Smart Contract (Polygon):                                        â”‚
â”‚                                                                  â”‚
â”‚ registerShop()                                                   â”‚
â”‚ â”œâ”€ Shop provides liquidity                                       â”‚
â”‚ â”œâ”€ Gets voucher generation rights                                â”‚
â”‚ â””â”€ Earns yield on stake                                          â”‚
â”‚                                                                  â”‚
â”‚ generateVouchers(count, amounts)                                 â”‚
â”‚ â”œâ”€ Generate cryptographic codes                                  â”‚
â”‚ â”œâ”€ Store on-chain                                                â”‚
â”‚ â””â”€ Return codes to shop                                          â”‚
â”‚                                                                  â”‚
â”‚ redeemVoucher(code)                                              â”‚
â”‚ â”œâ”€ Verify code validity                                          â”‚
â”‚ â”œâ”€ Mint/Transfer Custom Token                                    â”‚
â”‚ â”œâ”€ Uniswap Pool Interaction                                      â”‚
â”‚ â”œâ”€ Swap Custom Token â†’ ETH (Gas)                                 â”‚
â”‚ â”œâ”€ Convert remainder to USDC                                     â”‚
â”‚ â””â”€ Emit event                                                    â”‚
â”‚                                                                  â”‚
â”‚ settleCash()                                                     â”‚
â”‚ â”œâ”€ Shop reports cash collected                                   â”‚
â”‚ â”œâ”€ Off-chain: Shop sends cash to TextChain                       â”‚
â”‚ â”œâ”€ On-chain: Liquidity rebalancing                               â”‚
â”‚ â””â”€ Shop can issue more vouchers                                  â”‚
â”‚                                                                  â”‚
â”‚ Backend Service:                                                 â”‚
â”‚ â€¢ Monitor RedeemVoucher events                                   â”‚
â”‚ â€¢ Update user balance                                            â”‚
â”‚ â€¢ Send SMS confirmation                                          â”‚
â”‚ â€¢ Track shop settlements                                         â”‚
â”‚ â€¢ Calculate commissions                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. TRANSACTION SERVICE                                           â”‚
â”‚                                                                  â”‚
â”‚ User: "SEND 10 USDC TO +254712345678"                            â”‚
â”‚ â†“                                                                â”‚
â”‚ CommandParser                                                    â”‚
â”‚ â”œâ”€ Extract: amount=10, token=USDC, recipient=+254712345678       â”‚
â”‚ â””â”€ Validate format                                               â”‚
â”‚ â†“                                                                â”‚
â”‚ SecurityService                                                  â”‚
â”‚ â”œâ”€ Verify PIN (if set)                                           â”‚
â”‚ â”œâ”€ Check daily limit ($500/day)                                  â”‚
â”‚ â”œâ”€ Check transaction limit ($100/tx)                             â”‚
â”‚ â”œâ”€ Fraud check (velocity, patterns)                              â”‚
â”‚ â””â”€ âœ“ Approved                                                    â”‚
â”‚ â†“                                                                â”‚
â”‚ RecipientResolver                                                â”‚
â”‚ â”œâ”€ Lookup +254712345678 in database                              â”‚
â”‚ â”œâ”€ Found: wallet_address = 0x8f5c2a...                           â”‚
â”‚ â””â”€ Get recipient's preferred chain (Base)                        â”‚
â”‚ â†“                                                                â”‚
â”‚ LiFiService (Route Optimization)                                â”‚
â”‚ â”œâ”€ User on: Polygon                                             â”‚
â”‚ â”œâ”€ Recipient on: Base                                           â”‚
â”‚ â”œâ”€ Compare routes:                                              â”‚
â”‚ â”‚  â€¢ Polygon â†’ Base via Stargate: $1.50                        â”‚
â”‚ â”‚  â€¢ Polygon â†’ Base via Across: $0.50                          â”‚
â”‚ â”‚  â€¢ Polygon â†’ Base via Hop: $0.80                             â”‚
â”‚ â””â”€ Select: Across (cheapest)                                    â”‚
â”‚ â†“                                                                â”‚
â”‚ Bridge Execution                                                 â”‚
â”‚ â”œâ”€ Lock 10 USDC on Polygon                                      â”‚
â”‚ â”œâ”€ Wait for filler/relayer                                      â”‚
â”‚ â”œâ”€ Release 10 USDC on Base                                      â”‚
â”‚ â””â”€ Tx hash: 0xabc123...                                         â”‚
â”‚ â†“                                                                â”‚
â”‚ BalanceUpdater                                                   â”‚
â”‚ â”œâ”€ Sender: -10 USDC                                             â”‚
â”‚ â””â”€ Recipient: +10 USDC                                          â”‚
â”‚ â†“                                                                â”‚
â”‚ SMSNotifier                                                      â”‚
â”‚ â”œâ”€ To sender: "âœ“ Sent 10 USDC to Kenya. Fee: $0.50"           â”‚
â”‚ â””â”€ To recipient: "âœ“ Received 10 USDC from India"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. UNISWAP INTEGRATION                                           â”‚
â”‚                                                                  â”‚
â”‚ User: "POOL ADD 25 USDC 0.01 ETH"                              â”‚
â”‚ â†“                                                                â”‚
â”‚ UniswapService                                                   â”‚
â”‚ â”œâ”€ Validate amounts                                             â”‚
â”‚ â”œâ”€ Check balances                                               â”‚
â”‚ â”œâ”€ Select fee tier (0.3%)                                       â”‚
â”‚ â””â”€ Calculate tick range (Â±10% from current price)              â”‚
â”‚ â†“                                                                â”‚
â”‚ Approve tokens                                                   â”‚
â”‚ â”œâ”€ USDC.approve(PositionManager, 25 USDC)                      â”‚
â”‚ â””â”€ WETH.approve(PositionManager, 0.01 ETH)                     â”‚
â”‚ â†“                                                                â”‚
â”‚ Uniswap V3 Position Manager                                     â”‚
â”‚ â”œâ”€ mint() function                                              â”‚
â”‚ â”‚  â”œâ”€ token0: USDC                                             â”‚
â”‚ â”‚  â”œâ”€ token1: WETH                                             â”‚
â”‚ â”‚  â”œâ”€ fee: 3000 (0.3%)                                         â”‚
â”‚ â”‚  â”œâ”€ tickLower: -887220                                       â”‚
â”‚ â”‚  â”œâ”€ tickUpper: 887220                                        â”‚
â”‚ â”‚  â”œâ”€ amount0: 25 USDC                                         â”‚
â”‚ â”‚  â””â”€ amount1: 0.01 ETH                                        â”‚
â”‚ â”œâ”€ Returns: tokenId = 12345                                     â”‚
â”‚ â””â”€ NFT minted to user                                           â”‚
â”‚ â†“                                                                â”‚
â”‚ PositionTracker                                                  â”‚
â”‚ â”œâ”€ Store position ID                                            â”‚
â”‚ â”œâ”€ Track initial amounts                                        â”‚
â”‚ â”œâ”€ Monitor fees earned                                          â”‚
â”‚ â””â”€ Calculate APY                                                â”‚
â”‚ â†“                                                                â”‚
â”‚ SMS: "âœ“ Pool created! Position #12345. Earning 0.3% fees"      â”‚
â”‚                                                                  â”‚
â”‚ Ongoing:                                                         â”‚
â”‚ â€¢ Every 1 hour: Check fees earned                              â”‚
â”‚ â€¢ Every 1 day: Calculate APY                                   â”‚
â”‚ â€¢ User queries: "POOL EARNINGS" â†’ Show real-time fees          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. LIQUIDITY MANAGEMENT                                          â”‚
â”‚                                                                  â”‚
â”‚ TextChain Treasury                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Total: $500,000 USDC                                 â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Hot Wallet (10%): $50K                               â”‚       â”‚
â”‚ â”‚  â”œâ”€ Instant redemptions                               â”‚       â”‚
â”‚ â”‚  â”œâ”€ Monitored 24/7                                    â”‚       â”‚
â”‚ â”‚  â””â”€ Auto-refilled when < $10K                         â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Warm Wallet (30%): $150K                             â”‚       â”‚
â”‚ â”‚  â”œâ”€ Daily operations                                  â”‚       â”‚
â”‚ â”‚  â”œâ”€ Shop settlements                                  â”‚       â”‚
â”‚ â”‚  â””â”€ Refills hot wallet                                â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Cold Storage (40%): $200K                            â”‚       â”‚
â”‚ â”‚  â”œâ”€ Multi-sig Gnosis Safe                             â”‚       â”‚
â”‚ â”‚  â”œâ”€ 3/5 signatures required                           â”‚       â”‚
â”‚ â”‚  â””â”€ Emergency reserves                                â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Yield Farming (20%): $100K                           â”‚       â”‚
â”‚ â”‚  â”œâ”€ Uniswap V3 pools                                  â”‚       â”‚
â”‚ â”‚  â”œâ”€ Earning 10-15% APY                                â”‚       â”‚
â”‚ â”‚  â””â”€ Withdrawable if needed                            â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚ Shop Stakes (Distributed Liquidity)                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Shop A: $10,000 USDC staked                          â”‚       â”‚
â”‚ â”‚  Shop B: $10,000 USDC staked                          â”‚       â”‚
â”‚ â”‚  Shop C: $10,000 USDC staked                          â”‚       â”‚
â”‚ â”‚  ...                                                   â”‚       â”‚
â”‚ â”‚  Shop Z: $10,000 USDC staked                          â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â”‚  Total: $1,000,000 in distributed liquidity           â”‚       â”‚
â”‚ â”‚  (from 100 shops)                                     â”‚       â”‚
â”‚ â”‚                                                        â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚ Auto-Rebalancing (Every Hour)                                   â”‚
â”‚ â”œâ”€ Check hot wallet balance                                     â”‚
â”‚ â”œâ”€ If < $10K: Transfer from warm wallet                        â”‚
â”‚ â”œâ”€ If warm < $50K: Withdraw from yield farming                 â”‚
â”‚ â”œâ”€ If total < 20% obligations: Emergency mode                  â”‚
â”‚ â””â”€ Alert team if critical                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. SECURITY SYSTEM                                               â”‚
â”‚                                                                  â”‚
â”‚ Every Transaction Goes Through:                                 â”‚
â”‚                                                                  â”‚
â”‚ 1. PIN Verification                                             â”‚
â”‚    â”œâ”€ Hash entered PIN with Argon2                             â”‚
â”‚    â”œâ”€ Compare with stored hash                                  â”‚
â”‚    â”œâ”€ 3 attempts before lockout                                â”‚
â”‚    â””â”€ âœ“ / âœ—                                                     â”‚
â”‚                                                                  â”‚
â”‚ 2. Limit Checks                                                 â”‚
â”‚    â”œâ”€ Daily limit: $500/day (adjustable)                       â”‚
â”‚    â”œâ”€ Per-tx limit: $100/tx (adjustable)                       â”‚
â”‚    â”œâ”€ Spending today: $50                                       â”‚
â”‚    â””â”€ âœ“ $60 tx approved (within limits)                        â”‚
â”‚                                                                  â”‚
â”‚ 3. Velocity Check                                               â”‚
â”‚    â”œâ”€ Max 10 tx per hour                                        â”‚
â”‚    â”œâ”€ Current: 3 tx in last hour                               â”‚
â”‚    â””â”€ âœ“ Approved                                                â”‚
â”‚                                                                  â”‚
â”‚ 4. Fraud Detection                                              â”‚
â”‚    â”œâ”€ New user + large amount? Flag                            â”‚
â”‚    â”œâ”€ Sends to many addresses? Flag                            â”‚
â”‚    â”œâ”€ Known scam address? Block                                â”‚
â”‚    â”œâ”€ Unusual pattern? Review                                   â”‚
â”‚    â””â”€ Score: 15/100 (low risk) â†’ âœ“ Approved                    â”‚
â”‚                                                                  â”‚
â”‚ 5. Geographic Check                                             â”‚
â”‚    â”œâ”€ User location: India                                      â”‚
â”‚    â”œâ”€ Recipient: Kenya                                          â”‚
â”‚    â”œâ”€ Pattern: Normal cross-border                             â”‚
â”‚    â””â”€ âœ“ Approved                                                â”‚
â”‚                                                                  â”‚
â”‚ If ANY check fails:                                             â”‚
â”‚ â”œâ”€ Yellow flag: Require SMS confirmation                        â”‚
â”‚ â”œâ”€ Orange flag: Manual review (1-24 hours)                     â”‚
â”‚ â””â”€ Red flag: Block + notify user                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. DATABASE SCHEMA                                              â”‚
â”‚                                                                  â”‚
â”‚ PostgreSQL Tables:                                              â”‚
â”‚                                                                  â”‚
â”‚ users                                                            â”‚
â”‚ â”œâ”€ id (uuid, primary key)                                       â”‚
â”‚ â”œâ”€ phone_number (varchar, unique)                              â”‚
â”‚ â”œâ”€ wallet_address (varchar)                                     â”‚
â”‚ â”œâ”€ encrypted_private_key (text)                                â”‚
â”‚ â”œâ”€ pin_hash (varchar)                                           â”‚
â”‚ â”œâ”€ preferred_language (varchar)                                â”‚
â”‚ â”œâ”€ daily_limit_usd (decimal)                                   â”‚
â”‚ â”œâ”€ balance_usdc (decimal)                                       â”‚
â”‚ â”œâ”€ kyc_status (enum)                                            â”‚
â”‚ â”œâ”€ is_active (boolean)                                          â”‚
â”‚ â”œâ”€ created_at (timestamp)                                       â”‚
â”‚ â””â”€ updated_at (timestamp)                                       â”‚
â”‚                                                                  â”‚
â”‚ transactions                                                     â”‚
â”‚ â”œâ”€ id (uuid, primary key)                                       â”‚
â”‚ â”œâ”€ user_id (uuid, foreign key)                                 â”‚
â”‚ â”œâ”€ type (enum: deposit, send, receive, swap, pool)            â”‚
â”‚ â”œâ”€ amount (decimal)                                             â”‚
â”‚ â”œâ”€ token (varchar)                                              â”‚
â”‚ â”œâ”€ from_address (varchar)                                       â”‚
â”‚ â”œâ”€ to_address (varchar)                                         â”‚
â”‚ â”œâ”€ chain_id (integer)                                           â”‚
â”‚ â”œâ”€ tx_hash (varchar)                                            â”‚
â”‚ â”œâ”€ status (enum: pending, confirmed, failed)                   â”‚
â”‚ â”œâ”€ fee_usdc (decimal)                                           â”‚
â”‚ â”œâ”€ created_at (timestamp)                                       â”‚
â”‚ â””â”€ confirmed_at (timestamp)                                     â”‚
â”‚                                                                  â”‚
â”‚ uniswap_positions                                               â”‚
â”‚ â”œâ”€ id (uuid, primary key)                                       â”‚
â”‚ â”œâ”€ user_id (uuid, foreign key)                                 â”‚
â”‚ â”œâ”€ position_id (bigint, unique)                                â”‚
â”‚ â”œâ”€ token0 (varchar)                                             â”‚
â”‚ â”œâ”€ token1 (varchar)                                             â”‚
â”‚ â”œâ”€ amount0 (decimal)                                            â”‚
â”‚ â”œâ”€ amount1 (decimal)                                            â”‚
â”‚ â”œâ”€ fees_earned (decimal)                                        â”‚
â”‚ â”œâ”€ chain_id (integer)                                           â”‚
â”‚ â”œâ”€ created_at (timestamp)                                       â”‚
â”‚ â””â”€ last_updated (timestamp)                                     â”‚
â”‚                                                                  â”‚
â”‚ vouchers                                                         â”‚
â”‚ â”œâ”€ id (uuid, primary key)                                       â”‚
â”‚ â”œâ”€ code_hash (varchar, unique)                                 â”‚
â”‚ â”œâ”€ shop_address (varchar)                                       â”‚
â”‚ â”œâ”€ inr_amount (decimal)                                         â”‚
â”‚ â”œâ”€ is_redeemed (boolean)                                        â”‚
â”‚ â”œâ”€ redeemed_by (uuid, foreign key, nullable)                   â”‚
â”‚ â”œâ”€ created_at (timestamp)                                       â”‚
â”‚ â””â”€ redeemed_at (timestamp, nullable)                           â”‚
â”‚                                                                  â”‚
â”‚ shops                                                            â”‚
â”‚ â”œâ”€ id (uuid, primary key)                                       â”‚
â”‚ â”œâ”€ address (varchar, unique)                                    â”‚
â”‚ â”œâ”€ name (varchar)                                               â”‚
â”‚ â”œâ”€ location (varchar)                                           â”‚
â”‚ â”œâ”€ staked_amount (decimal)                                      â”‚
â”‚ â”œâ”€ available_balance (decimal)                                  â”‚
â”‚ â”œâ”€ total_commission (decimal)                                   â”‚
â”‚ â”œâ”€ vouchers_sold (integer)                                      â”‚
â”‚ â”œâ”€ vouchers_redeemed (integer)                                  â”‚
â”‚ â”œâ”€ is_active (boolean)                                          â”‚
â”‚ â””â”€ created_at (timestamp)                                       â”‚
â”‚                                                                  â”‚
â”‚ Redis Cache:                                                     â”‚
â”‚ â”œâ”€ balance:{user_id} â†’ USDC balance (TTL: 5 min)              â”‚
â”‚ â”œâ”€ rate:USDC:INR â†’ Exchange rate (TTL: 1 min)                 â”‚
â”‚ â”œâ”€ pending_tx:{tx_hash} â†’ Transaction status (TTL: 1 hour)    â”‚
â”‚ â””â”€ session:{phone} â†’ Command context (TTL: 10 min)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

# COMPLETE USER FLOWS

## Flow 1: Crypto User (Tier 1)

```
1. Registration
   User â†’ SMS: "JOIN"
   Backend â†’ Create wallet
   Backend â†’ SMS: "Welcome! Wallet: 0x742d..."

2. Deposit
   User â†’ Opens Binance
   User â†’ Withdraw USDC to 0x742d...
   User â†’ Network: Polygon
   User â†’ Amount: 50 USDC
   User â†’ Confirm
   [2-5 minutes pass]
   Backend â†’ Detects deposit
   Backend â†’ SMS: "âœ“ Received 50 USDC"

3. Check Balance
   User â†’ SMS: "BALANCE"
   Backend â†’ SMS: "Balance: 50.00 USDC"

4. Create Pool
   User â†’ SMS: "POOL ADD 25 USDC 0.01 ETH"
   Backend â†’ Approve tokens
   Backend â†’ Call Uniswap
   Backend â†’ SMS: "âœ“ Pool created! Earning 0.3% fees"

5. Send Money
   User â†’ SMS: "SEND 10 USDC TO +254712345678"
   Backend â†’ LI.FI routing (Polygon â†’ Base)
   Backend â†’ Execute Bridge (Across/Stargate)
   Backend â†’ SMS: "âœ“ Sent! Fee: $0.50"
   Recipient â†’ SMS: "âœ“ Received 10 USDC from India"
```

## Flow 2: Cash User (Tier 2)

```
1. Registration
   User â†’ SMS: "JOIN"
   Backend â†’ Create wallet
   Backend â†’ SMS: "Welcome! Wallet: 0x742d..."

2. Find Shop
   User â†’ SMS: "SHOPS"
   Backend â†’ Query database for nearby shops
   Backend â†’ SMS: "Raj Kirana - 500m away
                   Address: CP, Delhi"

3. Buy Voucher
   User â†’ Visits Raj Kirana
   User â†’ "I want â‚¹500 TextChain voucher"
   Raj â†’ Prints voucher code: JKXM4P29SL
   User â†’ Pays â‚¹510 cash

4. Redeem Voucher
   User â†’ SMS: "REDEEM JKXM4P29SL"
   Backend â†’ Validate code
   Backend â†’ Call smart contract
   Smart Contract â†’ Mint Custom Shop Token (tSHOP) to User
   Backend â†’ Trigger Uniswap Auto-Swap
   Uniswap â†’ Swap tSHOP for ETH (Gas) & USDC
   Backend â†’ SMS: "âœ“ Redeemed! Balance: 5.92 USDC"

5. Send Money
   User â†’ SMS: "SEND 5 USDC TO +254712345678"
   [Same as Flow 1, step 5]
```

---

## ğŸ“‚ Repository Structure

*   **`sms-request-handler/`**: The core Rust application.
    *   Handles SMS webhooks.
    *   Parses natural language-like commands.
    *   Manages the database (Users, Vouchers, Transactions).
    *   Executes blockchain transactions using `ethers-rs`.

## ğŸš€ Getting Started

### Prerequisites
*   Rust (latest stable)
*   PostgreSQL / SQLite
*   Twilio Account (for SMS)

### Installation
```bash
git clone https://github.com/minrawsjar/Text-to-Chain.git
cd Text-to-Chain/sms-request-handler

# Setup environment
cp .env.example .env
# Edit .env with your credentials

# Run database setup
./run-sqlite.sh # or setup Postgres

# Run server
cargo run
```

---

## ğŸ’¬ Command Reference
| Command | Description |
| --- | --- |
| `JOIN` | Create a new wallet |
| `BALANCE` | Check account balance across chains |
| `DEPOSIT` | Get wallet address for funding |
| `REDEEM <code>` | Redeem a cash voucher |
| `SEND <amt> <token> TO <phone>` | Send crypto to another phone number |
| `CHAIN <name>` | Switch active network (e.g., `CHAIN POLYGON`) |
